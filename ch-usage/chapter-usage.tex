
\chapter{Usage\label{ch:usage}}

% To start, in your main .tex file, use this class as your main documentclass instead of `report' or `book'. For example:
% \begin{quote}
% $\backslash documentclass[12pt,lot, lof]\{puthesis\}$
% \end{quote}

% In this example, we setup our document to use the PU Thesis style, with 12pt font for body text, and to include a List of Tables and List of Figures in the front matter. You could instead set an 11 point or 10 point font by changing the first option. You can also add `los' to include a list of symbols.

% To use single spacing, add the option `singlespace'. This is a special option for the \texttt{puthesis} documentclass, which sets single spacing for both the front matter and for the document itself. Additional parameters should be set in your main .tex file, and are described in detail in Section~\ref{sec:usage:options}.

% The template itself declares two other options, to be set immediately after the \texttt{documentclass} command. First is `printmode', declared with the command:
% \begin{quote}
% $\backslash newcommand\{\backslash printmode\}\{\}$
% \end{quote}
% This command, used later in the thesis.tex file, turns off the \texttt{hyperref} package and all internal links in the PDF file. This removes any colored links and highlighting that would not be appropriate in a printed and bound thesis. Instead the \texttt{url} package is loaded, so that \\url commands in your document will continue to work and urls will break properly across multiple lines.

% When `printmode' is not specified, the hyperref package is included. It creates colored links for citations, footnotes, and internal references, which can be used to navigate the PDF document more easily. It also adds bookmarks to the PDF file, mirroring the table of contents. By default, it is set to use colored links. For the PDF file that you will submit electronically to ProQuest, this may not be desirable since some copies may be printed, while others will be used electronically. Thus another option, `proquestmode', is defined that keeps hyperref but disables colored links:
% \begin{quote}
% $\backslash newcommand\{\backslash proquestmode\}\{\}$
% \end{quote}
% This mode has no effect when used in combination with `printmode'. 


% \input{ch-usage/usage_options} 

The Pedism library allows for the use of pedestrian dynamics into our own software. The libpedsim simulation rendering engine can be extended, modified and modeled to suit specific behavior patterns and scenarios. The above disaster considered is fire and through this thesis, we aim to demonstrate the capabilities of this microscopic simulator, modeling crowds during an emergency evacuation using the above mentioned building topology. 

The implementation of this scenario using Pedsim is developed on Ubuntu 18.04 using libpedsim version 2.4.2.
The library itself contains many subsections and modules which handle specific tasks such as agent movement, topology description etc. The various modules of the pedsim library is described below.

The libpedsim tool can be broadly classified into 2 sections - the simulation of pedestrians and graphically rendering the simulation process onto a QT based graphical window to depict the flow of agents in real time process.

The following modules are part of rendering output to a graphical window
agent.h
agent.cpp
Cell.h
Cell.cpp
Config.h
Config.cpp
Control.h
Control.cpp
Control.ui
Grid.h
Grid.cpp
Mainwindow.h
Mainwindow.cpp
Moc_loadscene.cpp
Moc_control.cpp
Moc_mainwindow.cpp
Moc_scene.cpp
Moc_predefs.h
Qrc_application.cpp
Scene.h
Scene.cpp
Style.h
Style.cpp
tree.h
tree.cpp
ui_control.h
waypoint.h
waypoint.cpp

As the above modules are used to render the algorithm to a graphical output, most of the modules as mentioned above need very little to no modification whatsoever. It is also worth noting that the modules “agent.h” and “agent.cpp” contains the actual definitions for the behavior of pedestrian agents. These behavior functions are implemented by the author of the tool as a generic inter-agent based interaction and is developed keeping in mind to add further and more complex behavioral functionalities. These functions can be extended in the “ped_agent.h” and “ped_agent.cpp” respectively. 
The following modules below represent the core modules that we extend and modify to suit the scenario at hand:
coppito.h
coppito.cpp
loadscene.h
loadscene.cpp
ped_agent.h
Ped_agent.cpp
main.cpp

 The first two modules - “coppito.h” and “coppito.cpp” is an external module that is incorporated into the source of the libpedsim library for the specific purposes of modeling the building “Coppito 0”, as the name suggests. The detailed description of “coppito.h” and “coppito.cpp” will be listed after the brief description of the other mentioned modules. 

“loadscene” module is used to generate and extract the specific topology of the building. The exact dimensions of the building is stored on an .xml file which is then fed into the loadscene module to incorporate into the library source for graphical representation. This .xml file has specific tags which can be used to not only describe the dimensions of the building but also to specify the number of agents and the path of their trajectory - mentioned as “waypoint” within the .xml file. This information is then retrieved by the loadscene module, extract information from the various mentioned tags, and generating the mentioned number of total agens on the graphical output, adding the constrained waypoints to the agents, and most importantly, to gather the information required to generate a graph that depicts the nature of the building in description.

The “ped_agent” module describes the behavior and movement of the agent that is to be rendered to the graphical window. This module consists of behavior functionalities that typically incorporates “social forces”, “obstacle forces”, “look ahead force”, “desired force” and “my force”. The definition of these “forces” (generic navigation constraints and behaviors) are explained below:

my force:
myForce() is a method that returns an "empty" force (all components set to 0). This method can be overridden in order to define own forces. This can thus be used to model more complex human navigation/decision making patterns.
lookahead force:
This calculates the mental layer force of the strategy "look ahead". It is implemented here in the physical layer because of performance reasons.
obstacle force:
This calculates the force between this agent and the nearest obstacle in this scene.
It iterates over all obstacles.
Hence the complexity of this module is equal to O(N).
social force:
This module calculates the social force between this agent and all the other agents belonging to the same scene.  It iterates over all agents inside the scene.
Hence it has a complexity of O(N^2).
desired force:
This module calculates the force between this agent and the next assigned waypoint.  If the waypoint has been reached, the next waypoint in the list will be selected.
At the moment, a visited waypoint is pushed back to the end of the list, which means that the agents will visit all the waypoints over and over again.
  
The main behavioral functionalities to be incorporated is thus implemented in the ped_agent module. The agents are made to move according the complex grid geometry based architecture called “Alan Turing Building Architecture” which is implemented in the “coppito” source module.

As aforementioned, the .xml file contains a generic description of the topology of the building that is to be modeled and used for rendering simulation. The coppito.xml is the file used in our case for the modeling of our present scenario. This information is retrieved by the “loadscene” module to extract the exact graphical plot points to draw the building. 

“coppito” module pipelines this plot information for further processing. The scenario is strictly modeled according to the work presented in “An IoT Software Architecture for an Evacuable Building Architecture” by Mahyar Moghaddam et.al. Various constraints are mentioned in the paper for realistic simulation. Further constraints are provided in the paper for linearization of the constraints for effectively reducing the evacuation time of the agents. However since its redundant to use linearization within the pedsim framework to simulate for the scenario we mainly consider only 3 of the below mentioned constraints.



